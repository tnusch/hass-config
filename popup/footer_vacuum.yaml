action: fire-dom-event
browser_mod:
  service: browser_mod.popup
  data:
    title: Dammsugare
    timeout: 300000
    style: |
      --popup-max-width: calc(385px + 495px);
      --primary-color: transparent; /* hide timeout progress */
    card_mod:
      style:
        # card divider border
        layout-card$grid-layout$: |
          #root {
            margin: -24px 0 !important;
          }
          hui-vertical-stack-card {
            border-right: 1.5px solid rgba(0, 0, 0, 0.2);
            border-radius: 0;
            transition: none;
          }
          /* phone */
          @media screen and (max-width: 800px) {
            hui-vertical-stack-card {
              border-right: none;
              border-bottom: 1.5px solid rgba(0, 0, 0, 0.2);
            }
          }
    content:
      type: custom:layout-card
      layout_type: custom:grid-layout
      layout:
        margin: 0
        grid-template-columns: 385px 495px
        grid-template-rows: 1fr
        grid-template-areas: |
          "info map"
        mediaquery:
          #phone
          "(max-width: 800px)":
            grid-template-columns: 1fr
            grid-template-rows: repeat(2, 1fr)
            grid-template-areas: |
              "info"
              "map"
      cards:
        ### ÖVERSIKT

        - type: vertical-stack
          view_layout:
            grid-area: info
          cards:
            - type: entities
              title: Översikt
              card_mod:
                class: header
                style: |
                  .card-content {
                    padding: var(--tablet-popup-content-padding);
                    padding-bottom: 0;
                  }
              entities:
                - entity: vacuum.robi
                - entity: sensor.robi_last_clean_end
                - entity: sensor.template_last_clean_duration_min
                  name: Dauer

                - type: custom:bar-card
                  width: 55%
                  height: 2em
                  decimal: 0
                  unit_of_measurement: "%"
                  positions:
                    icon: outside
                    indicator: "off"
                    name: outside
                  severity:
                    - color: "#303435"
                      from: 11
                      to: 999
                    - color: "#6d2525"
                      from: 0
                      to: 10
                  entity_row: true
                  entities:
                    - entity: vacuum.robi
                      attribute: battery_level
                      name: Batterie
                      icon: mdi:battery
                    - entity: sensor.template_vacuum_filter
                    - entity: sensor.template_vacuum_mainbrush
                    - entity: sensor.template_vacuum_sidebrush
                    - entity: sensor.template_vacuum_sensors

                - type: custom:more-info-card
                  entity: vacuum.robi
                  card_mod:
                    style:
                      # hide everything but ha-select
                      .: |
                        h1, state-card-content {
                          display: none;
                        }
                        .card-content {
                          padding: 1.5em 0 0 0.7em;
                        }
                      more-info-vacuum$:
                        .: |
                          div.flex-horizontal>div, div:nth-child(2), ha-attributes {
                            display: none;
                          }
                          ha-select {
                            display: contents;
                          }
                        ha-select:
                          $:
                            # no icon so remove label inset
                            .: |
                              .mdc-floating-label {
                                inset-inline-start: 0 !important;
                              }
                            # fix transparent menu background color
                            mwc-menu$: |
                              mwc-list {
                                background: var(--card-background-color);
                              }

            - type: custom:mod-card
              card_mod:
                style:
                  # horizontal bottom buttons
                  hui-horizontal-stack-card$: |
                    #root {
                      justify-content: space-evenly !important;
                      padding: var(--tablet-popup-button-padding);
                    }
              card:
                type: horizontal-stack
                cards:
                  - type: custom:button-card
                    entity: vacuum.robi
                    icon: mdi:play-pause
                    tap_action:
                      action: call-service
                      service: >
                        [[[
                          return `[[[
                            return entity.state === 'docked' || entity.state === 'paused'
                              ? 'vacuum.start'
                              : 'vacuum.pause';
                          ]]]`
                        ]]]
                      service_data:
                        entity_id: vacuum.robi
                    template: icon_only

                  - type: custom:button-card
                    entity: vacuum.robi
                    icon: mdi:battery-charging
                    tap_action:
                      action: call-service
                      service: vacuum.return_to_base
                      service_data:
                        entity_id: vacuum.robi
                    template: icon_only

                  - type: custom:button-card
                    icon: mdi:delete-empty
                    tap_action:
                      action: call-service
                      service: vacuum.send_command
                      service_data:
                        entity_id: vacuum.robi
                        command: app_goto_target
                        params: [16821, 23105]
                    template: icon_only

        ### KARTLÄGGNING

        - type: custom:xiaomi-vacuum-map-card
          title: Karte
          view_layout:
            grid-area: map
          card_mod:
            class: header
            style: |
              ha-card {
                --map-card-primary-color: #FFFFFF10;
                --map-card-secondary-color: none;
                --map-card-secondary-text-color: #9da0a2;
                --map-card-zoomer-background: none;
                --map-card-predefined-rectangle-fill-color: none;
                --map-card-predefined-rectangle-line-color: none;
                --map-card-predefined-rectangle-line-color-selected: rgba(255, 255, 255, 0.5);
                --map-card-predefined-rectangle-fill-color-selected: rgba(42, 124, 194, 0.1);
                --map-card-predefined-rectangle-icon-background-color-selected: rgb(42, 124, 194);
                --map-card-internal-big-radius: 0.6em !important;
              }
              div.map-wrapper, div.controls-wrapper {
                padding: var(--tablet-popup-content-padding);
                padding-top: 0;
                padding-bottom: 0;
                letter-spacing: normal;
              }
              div.tiles-wrapper, div.vacuum-controls, #map-zoomer-overlay {
                display: none;
              }
              div.map-controls-wrapper {
                padding-top: 24px;
              }
              paper-button {
                --mdc-icon-size: 2em;
                color: #9da0a2 !important;
                padding: 0.42em;
              }
          language: de
          entity: vacuum.robi
          map_source:
            camera: camera.xiaomi_cloud_map_extractor
          calibration_source:
            camera: true
          map_locked: true
          map_modes:
            - template: vacuum_clean_zone_predefined
              predefined_selections:
                - zones: [[18627, 22412, 20877, 26812]]
                  # label:
                  #   text: "Flur"
                  #   x: 19752
                  #   y: 24612
                  #   offset_y: 35
                  icon:
                    name: "mdi:door"
                    x: 19752
                    y: 24612
                - zones: [[20804, 24733, 26504, 30583]]
                  # label:
                  #   text: "Wohnzimmer"
                  #   x: 23654
                  #   y: 27658
                  #   offset_y: 35
                  icon:
                    name: "mdi:television"
                    x: 23654
                    y: 27658
                - zones: [[14107, 27029, 20557, 30629]]
                  # label:
                  #   text: "Schlafzimmer"
                  #   x: 17332
                  #   y: 28829
                  #   offset_y: 35
                  icon:
                    name: "mdi:bed"
                    x: 17332
                    y: 28829
                - zones: [[15301, 25470, 18601, 27020]]
                  # label:
                  #   text: "Bad"
                  #   x: 16951
                  #   y: 26245
                  #   offset_y: 35
                  icon:
                    name: "mdi:shower"
                    x: 16951
                    y: 26245
                - zones: [[14599, 22491, 18599, 25391]]
                  # label:
                  #   text: "Flur"
                  #   x: 16599
                  #   y: 23941
                  #   offset_y: 35
                  icon:
                    name: "mdi:laptop"
                    x: 16599
                    y: 23941
            - template: vacuum_clean_zone
            - template: vacuum_goto
            - template: vacuum_follow_path
